version: 0.2
env:
    variables:
        S3_BUCKET: "roaggarw1"
APP_NAME: "rohitaggarwal"
BUILD_ENV : "prod"

phases:
    install:
        commands:
        # Download and Install NodeJS 8.0
        - curl -sL https://rpm.nodesource.com/setup_10.x
        - sudo yum install -y nodejs
        - echo Installing source NPM dependencies...
        # Install http drivers for node
        - sudo yum update -y
       
        # Install Angular CLI, If you are not using Angular 6, install angular/cli@1.7.0 or lower, confirm by running ng -v inside your project folder
        - sudo npm install -g @angular/cli > /dev/null
        # Install node dependancies.
        # yum install
        -  sudo node -v
        - sudo npm -p
        - sudo ng version

build:
        commands:
        # Builds Angular application. You can also build using custom environment here like mock or staging
        - echo Build started on `date`
        - sudo ng build --${BUILD_ENV}

post_build:
        commands:
        # Clear S3 bucket.
        - aws s3 rm s3://${S3_BUCKET} --recursive
        - echo S3 bucket is cleared.
        # Copy dist folder to S3 bucket, As of Angular 6, builds are stored inside an app folder in distribution and not at the root of the dist folder
        - aws s3 cp dist s3://${S3_BUCKET}/${APP_NAME} --recursive
        - echo Build completed on `date`

artifacts:
    files:
        - '/'
    discard-paths: yes
    base-directory: 'dist*'
